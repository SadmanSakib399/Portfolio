<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Sadman Sakib | App container</title>

    <!-- CSS -->
    <link rel="stylesheet" href="css/core/reset.css">
    <link rel="stylesheet" href="css/core/variables.css">
    <link rel="stylesheet" href="css/core/layout.css">
    
    <link rel="stylesheet" href="css/background.css">
    <link rel="stylesheet" href="css/navbar.css">
    <link rel="stylesheet" href="css/sidebar.css">

    <link rel="stylesheet" href="css/portfolio.css">

    <link rel="stylesheet" href="css/smoke.css">
    <link rel="stylesheet" href="css/switch.css">

</head>

<body id="background-root">

    <!-- ===== PERSISTENT BACKGROUND (LOADS ONCE) ===== -->
    <canvas id="smokeCanvas"></canvas>

    <!-- ========== NAVBAR ========== -->
    <!-- LEFT TOGGLE BUTTON -->
    <label class="hamburger" id="menu-btn">
        <input type="checkbox" id="menu-toggle">
        <svg viewBox="0 0 32 32">
            <path class="line line-top-bottom"
                d="M27 10 13 10C10.8 10 9 8.2 9 6 9 3.5 10.8 2 13 2 15.2 2 17 3.8 17 6L17 26C17 28.2 18.8 30 21 30 23.2 30 25 28.2 25 26 25 23.8 23.2 22 21 22L7 22">
            </path>
            <path class="line" d="M7 16 27 16"></path>
        </svg>
    </label>

    <!-- LEFT SIDEBAR NAV -->
    <aside id="side-nav">
        <div class="radio-container">
            <input id="radio-portfolio" name="side-nav-radio" type="radio" />
            <label for="radio-portfolio">Portfolio</label>

            <input id="radio-blogs" name="side-nav-radio" type="radio" />
            <label for="radio-blogs">Blogs</label>

            <input id="radio-gallery" name="side-nav-radio" type="radio" />
            <label for="radio-gallery">Gallery</label>

            <input id="radio-thoughts" name="side-nav-radio" type="radio" />
            <label for="radio-thoughts">Thoughts</label>

            <div class="glider-container">
                <div class="glider"></div>
            </div>
        </div>


        <div class="bottom">

            <div class="switch-column">
                <span class="switch-label">Smoke</span>

                <label class="switch">
                    <input type="checkbox" id="mouse-trail-toggle" />
                    <span class="slider"></span>
                </label>
            </div>

            <div class="switch-column">
                <span class="switch-label">BG</span>

                <label class="switch">
                    <input type="checkbox" id="bg-toggle" />
                    <span class="slider"></span>
                </label>
            </div>

        </div>
    </aside>

    <!-- RIGHT NAVBAR -->
    <nav class="top-nav top_nav_bg">
        <div class="nav-inner">
            <span class="nav-glider"></span>
        </div>
    </nav>

    <!-- SPA CONTENT -->
    <main id="app-content"></main>

    <!-- NAVBAR -->
    <script src="js/components/navbar/navbar.render.js"></script>
    <script src="js/components/navbar/navbar.glider.js"></script>
    <script src="js/components/navbar/navbar.scrollspy.js"></script>
    <script src="js/components/navbar/navbar.background.js"></script>
    <script src="js/components/navbar/navbar.controller.js"></script>

    <!-- SIDEBAR -->
    <script src="js/components/sidebar/sidebar.toggle.js"></script>
    <script src="js/components/sidebar/sidebar.navigation.js"></script>
    <script src="js/components/sidebar/sidebar.close.js"></script>
    <script src="js/components/sidebar/sidebar.glider.js"></script>
    <script src="js/components/sidebar/sidebar.controller.js"></script>


    <script src="js/components/about.filter.js"></script>
    <script src="js/components/skills.js"></script> 


    <script src="js/effects/mouse_smoke.js"></script>

    <script src="js/core/spa.core.js"></script>
    <script src="js/core/spa.lifecycle.js"></script>

    <!-- Hash-based scroll on page load - prevents browser auto-jump -->
    <script>
        (function() {
            let pendingHash = null;
            let scrollHandled = false;

            // Capture and clear hash immediately to prevent browser jump
            function captureHash() {
                const hash = window.location.hash;
                if (hash) {
                    pendingHash = hash;
                    // Clear hash from URL to prevent browser auto-scroll
                    const url = window.location.href.split("#")[0];
                    history.replaceState(null, "", url);
                }
            }

            // Scroll to target after all initialization
            function scrollToHash() {
                if (!pendingHash || scrollHandled) return;

                const attemptScroll = () => {
                    const target = document.querySelector(pendingHash);
                    if (target) {
                        scrollHandled = true;
                        const navOffset = document.querySelector(".top-nav")?.offsetHeight || 80;
                        const y = target.getBoundingClientRect().top + window.pageYOffset - navOffset;
                        window.scrollTo({
                            top: y,
                            behavior: "smooth"
                        });
                        // Restore hash in URL after scroll starts
                        const currentUrl = window.location.href;
                        const urlWithoutHash = currentUrl.split("#")[0];
                        history.replaceState(null, "", urlWithoutHash + pendingHash);
                        return true;
                    }
                    return false;
                };

                // Wait for SPA content to be ready
                if (attemptScroll()) return;

                // If not found, wait for next frame (SPA might still be loading)
                requestAnimationFrame(() => {
                    if (!attemptScroll()) {
                        requestAnimationFrame(attemptScroll);
                    }
                });
            }

            // Capture hash immediately (before DOMContentLoaded)
            captureHash();

            // Scroll after all initialization completes
            function waitForSPAAndScroll() {
                const appContent = document.getElementById("app-content");
                if (appContent && appContent.children.length > 0) {
                    // SPA content is loaded, wait for page-enter animation to complete
                    if (appContent.classList.contains("page-enter")) {
                        const observer = new MutationObserver(() => {
                            if (!appContent.classList.contains("page-enter")) {
                                observer.disconnect();
                                requestAnimationFrame(() => {
                                    scrollToHash();
                                });
                            }
                        });
                        observer.observe(appContent, { attributes: true, attributeFilter: ["class"] });
                    } else {
                        // Page already loaded, scroll immediately
                        requestAnimationFrame(() => {
                            scrollToHash();
                        });
                    }
                } else {
                    // SPA not ready yet, wait and retry
                    requestAnimationFrame(waitForSPAAndScroll);
                }
            }

            if (document.readyState === "loading") {
                document.addEventListener("DOMContentLoaded", () => {
                    waitForSPAAndScroll();
                });
            } else {
                waitForSPAAndScroll();
            }

            // Handle hash changes (for in-page navigation after initial load)
            window.addEventListener("hashchange", () => {
                if (scrollHandled) {
                    const hash = window.location.hash;
                    if (hash) {
                        const target = document.querySelector(hash);
                        if (target) {
                            const navOffset = document.querySelector(".top-nav")?.offsetHeight || 80;
                            const y = target.getBoundingClientRect().top + window.pageYOffset - navOffset;
                            window.scrollTo({
                                top: y,
                                behavior: "smooth"
                            });
                        }
                    }
                }
            });
        })();
    </script>

</body>


</html>